#include<iostream>
#include<vector>
#include<stack>
using namespace std;
const int maxnum=100;
const int maxint=999999;
int dist[maxnum];
int c[maxnum][maxnum];
int n,line;
void Dijkstra(int n, int v,int *dist,vector<int> *prev,int c[maxnum][maxnum])
{
    bool s[maxnum];
    for(int i=1;i<=n;++i)
    {
        dist[i]=c[v][i];
        s[i]=0;
        if(dist[i]<maxint){
        	prev[i].push_back(v);
		}
    }
    dist[v]=0;
    s[v]=1;
	for(int i=2;i<=n;++i)
    {
        int tmp=maxint;
        int u=v;
        for(int j=1;j<=n;++j)
            if((!s[j])&&dist[j]<tmp)
            {
                u=j;
                tmp=dist[j];
            }
        s[u]=1;
		for(int j=1;j<=n;++j)
            if((!s[j])&&c[u][j]<maxint)
            {
                int newdist=dist[u]+c[u][j];
                if(newdist<=dist[j])
                {
                    if(newdist<dist[j]){
                      prev[j].clear();
                      dist[j]=newdist;
                    }
                    prev[j].push_back(u);
                }
            }
    }
}
void searchPath(vector<int> *prev,int v,int u,int sta[],int len){
    if(u==v){
        cout<<v;
        return;
    }
    sta[len]=u;
    for(int i=0;i<prev[u].size();++i){
        if(i>0){
            for(int j=len-1;j>=0;--j){
                cout<<" -> "<<sta[j];
            }
            cout<<endl;
        }
        searchPath(prev,v,prev[u][i],sta,len+1);
        cout<<" -> "<<u;
    }
}
int main(){
    vector<int> prev[maxnum];
    cin>>n;
    cin>>line;
    int p,q,len;
     for(int i=1;i<=n;++i)
        for(int j=1;j<=n;++j)
            c[i][j]=maxint;
    for(int i=1;i<=line;++i)  
    {
        cin>>p>>q>>len;
        if(len<c[p][q])
        {
            c[p][q]=len;
            c[q][p]=len;
        }
    }
    for(int i=1;i<=n;++i)
        dist[i]=maxint;
    for(int i=1;i<=n;++i)
    {
        for(int j=1;j<=n;++j)
            printf("%8d",c[i][j]);
        printf("\n");
    }
    Dijkstra(n,1,dist,prev,c);
    cout<<"最短路径长度:"<<dist[n]<<endl;
	cout<<"最短路径:"<<endl;
    int sta[maxnum];
    searchPath(prev,1,n,sta,0);
}
